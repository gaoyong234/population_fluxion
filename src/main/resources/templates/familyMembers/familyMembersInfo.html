<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>

    <script src="../static/plugins/jQuery/jquery-2.2.3.min.js"></script>
    <link rel="stylesheet" href="../static/plugins/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="../static/plugins/adminLTE/css/AdminLTE.css">
    <link rel="stylesheet" href="../static/plugins/adminLTE/css/skins/_all-skins.min.css">
    <link rel="stylesheet" href="../static/plugins/angularjs/toaster.min.css">
    <script src="../static/plugins/bootstrap/js/bootstrap.min.js"></script>

    <script src="../static/plugins/angularjs/angular.min.js"></script>
    <link rel="stylesheet" href="../static/plugins/angularjs/pagination.css">
    <script src="https://cdn.staticfile.org/angular.js/1.4.6/angular.min.js"></script>
</head>
<script>
    var app = angular.module("myApp",[]);
    app.controller("myCtrl",function ($scope,$http) {
        $(function () {
            $scope.find();
            $scope.findFaminyInfo();
        })
        $scope.find = function () {
            $http({
                method: 'GET',
                url: '/familyMembers/findFaminyInfo'
            }).then(function successCallback(response) {
                $scope.list = response.data
                for (var i = 0; i <$scope.list.length ; i++) {
                    if ($scope.list[i].familySex == 0){
                        $scope.list[i].familySex = "女";
                    }
                    if ($scope.list[i].familySex == 1){
                        $scope.list[i].familySex = "男";
                    }
                    if ($scope.list[i].familyVaccine == 0){
                        $scope.list[i].familyVaccine = "无";
                    }
                    if ($scope.list[i].familyVaccine == 1){
                        $scope.list[i].familyVaccine = "有";
                    }
                    if ($scope.list[i].familyLearn == 0){
                        $scope.list[i].familyLearn = "否";
                    }
                    if ($scope.list[i].familyLearn == 1){
                        $scope.list[i].familyLearn = "是";
                    }
                }
                // 请求成功执行代码
            }, function errorCallback(response) {
                // 请求失败执行代码
            });
        }

        //查找字典表关系信息
        $scope.findFaminyInfo = function() {
            $http({
                method: 'GET',
                url: '/familyMembers/findRelationshipInfo'
            }).then(function successCallback(response) {
                var relationship = []
                for (var i = 0; i <response.data.length ; i++) {
                    if (response.data[i].fid == 1000){
                        relationship.push(response.data[i]);
                    }
                }
                $scope.relationship = relationship;
            }, function errorCallback(response) {
                // 请求失败执行代码
            });
        }

        //保存同住家庭成员信息
        $scope.obj={};
        $scope.save = function () {
            var data = $scope.obj
            console.log(data);
           $http({
                method: 'POST',
                url: '/familyMembers/saveFamilyInfo',
                params:data
            }).then(function successCallback(response) {
               if (response.data>0){
                   alert("保存成功!")
               }else {
                   alert("保存失败!")
               }
                // 请求成功执行代码
            }, function errorCallback(response) {
                // 请求失败执行代码
            });
        }

    })
</script>
<body ng-app="myApp" ng-controller="myCtrl">
    <div>
    <table id="dataList" class="table">
        <thead>
        <tr>
            <th>编号</th>
            <th>关系</th>
            <th>公民身份证号</th>
            <th>姓名</th>
            <th>性别</th>
            <th>出生日期</th>
            <th>有无预防接种证</th>
            <th>是否在本市就学</th>
        </tr>
        </thead>
        <tbody id="tbody">
        <tr>
            <th>编号</th>
            <th>
                <select id="spareInt" ng-model="obj.spareInt"  name="spareInt">
                    <option ng-repeat="x in relationship" ng-value="x.id">{{x.name}}</option>
                </select>
            </th>
            <th>
                <input type="text" ng-model="obj.familyNumber" name="familyNumber">
            </th>
            <th>
                <input type="text" ng-model="obj.familyName" name="familyName">
            </th>
            <th>
                <input type="radio" ng-model="obj.familySex" name="familySex" ng-value="1"/>男
                <input type="radio" ng-model="obj.familySex" name="familySex" ng-value="0"/>女
            </th>
            <th>
                <input type="date" ng-model="obj.familyBrithday" name="familyBrithday">
            </th>
            <th>
                <input type="radio" ng-model="obj.familyVaccine" name="familyVaccine" ng-value="1"/>有
                <input type="radio" ng-model="obj.familyVaccine" name="familyVaccine" ng-value="0"/>无
            </th>
            <th>
                <input type="radio" ng-model="obj.familyLearn" name="familyLearn" ng-value="1"/>是
                <input type="radio" ng-model="obj.familyLearn" name="familyLearn" ng-value="0"/>否
            </th>
        </tr>
        </tbody>
    </table>
        <center>
            <button class="btn btn-success" data-toggle="modal" data-target="#chage" ng-click="save()" >保 存</button>
            <button class="btn btn-success" data-toggle="modal" data-target="#chage" ng-click="" >下一项</button>
        </center>
    <tm-pagination conf="paginationConf"></tm-pagination>
</div>
</body>
</html>